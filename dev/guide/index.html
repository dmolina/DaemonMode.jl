<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>User Guide · DaemonMode.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://dmolina.github.io/DaemonMode.jl/guide/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">DaemonMode.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Quick Start</a></li><li class="is-active"><a class="tocitem" href>User Guide</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Usage"><span>Usage</span></a></li><li class="toplevel"><a class="tocitem" href="#Running-specific-code"><span>Running specific code</span></a></li><li class="toplevel"><a class="tocitem" href="#Running-several-clients-at-the-same-time"><span>Running several clients at the same time</span></a></li><li class="toplevel"><a class="tocitem" href="#Typical-errors"><span>Typical errors</span></a></li><li class="toplevel"><a class="tocitem" href="#Changing-the-port"><span>Changing the port</span></a></li><li class="toplevel"><a class="tocitem" href="#Different-contexts"><span>Different contexts</span></a></li><li class="toplevel"><a class="tocitem" href="#Shared-code-and-Conflict-of-names"><span>Shared code and Conflict of names</span></a></li><li class="toplevel"><a class="tocitem" href="#Debugging-a-script"><span>Debugging a script</span></a></li><li class="toplevel"><a class="tocitem" href="#Including-a-file"><span>Including a file</span></a></li><li class="toplevel"><a class="tocitem" href="#Automatically-reload-the-modified-packages"><span>Automatically reload the modified packages</span></a></li></ul></li><li><a class="tocitem" href="../posibilities/">Posibilities</a></li><li><a class="tocitem" href="../compiler/">with PackageCompiler</a></li><li><a class="tocitem" href="../reference/">Public API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>User Guide</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>User Guide</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/dmolina/DaemonMode.jl/blob/master/docs/src/guide.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="User-Guide"><a class="docs-heading-anchor" href="#User-Guide">User Guide</a><a id="User-Guide-1"></a><a class="docs-heading-anchor-permalink" href="#User-Guide" title="Permalink"></a></h1><p>This package has been developed taking in account the usage easily.</p><h1 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h1><ul><li>The server is the responsible of running all julia scripts.</li></ul><pre><code class="language-sh hljs">  julia -t auto -e &#39;using DaemonMode; serve()&#39;</code></pre><p>The <strong>-t auto</strong> allow clients to use several threads if they want it.</p><ul><li>A client, that send to the server the file to run, and return the output obtained.</li></ul><pre><code class="language- hljs">  julia -e &#39;using DaemonMode; runargs()&#39; program.jl &lt;arguments&gt;</code></pre><p>you can use an alias </p><pre><code class="language-sh hljs">  alias juliaclient=&#39;julia -e &quot;using DaemonMode; runargs()&quot;&#39;</code></pre><p>then, instead of <code>julia program.jl</code> you can do <code>juliaclient program.jl</code>. The output should be the same, but with a lot less time.</p><h1 id="Running-specific-code"><a class="docs-heading-anchor" href="#Running-specific-code">Running specific code</a><a id="Running-specific-code-1"></a><a class="docs-heading-anchor-permalink" href="#Running-specific-code" title="Permalink"></a></h1><p>Although the function <code>runargs()</code> is the simpler way to run the client, it is not the only function.</p><h1 id="Running-several-clients-at-the-same-time"><a class="docs-heading-anchor" href="#Running-several-clients-at-the-same-time">Running several clients at the same time</a><a id="Running-several-clients-at-the-same-time-1"></a><a class="docs-heading-anchor-permalink" href="#Running-several-clients-at-the-same-time" title="Permalink"></a></h1><p>In previous versions, the server run one task for each client. However, since v0.1.5 DaemonMode is able to run each client in parallel. However, you can run the server function with the parameter async=false to have the previous behaviour. In all following examples, I use <strong>-t auto</strong> to allow julia to use different CPUs.</p><pre><code class="language-sh hljs">$  julia -e &#39;using DaemonMode; serve(async=false)&#39;</code></pre><p>In that way, the juliaserver only work in a only CPU, and only each client is running at the same time.</p><p>The recommended way of running is always using <strong>-t auto</strong>.</p><pre><code class="language-sh hljs">$  julia -t auto -e &#39;using DaemonMode; serve(async=false)&#39;</code></pre><p>In that way, each client could use different CPUs, but only each client is running at the same time. However, the current client can run different threads.</p><p>With the optional parameter async=true to server, the server run each client in a new task, but only using a CPU.</p><pre><code class="language-sh hljs">$  julia -t auto -e &#39;using DaemonMode; serve(async=true)&#39;</code></pre><p>That command will allow to run different clients in parallel. It is using several threads in parallel by default. If you want to run different clients in parallel but always at the same CPU (pure async mode), you can do:</p><pre><code class="language-sh hljs">$  julia -t auto -e &#39;using DaemonMode; serve(async=true, threaded=false)&#39;</code></pre><p>Auto allows DaemonMode to use all processors of the computer, but you can put <em>-t 1</em>, <em>-t 2</em>, ... It is the default mode.</p><p>The parallel option have several advantages:</p><ul><li><p>You can run any new client without waiting the previous close.</p></li><li><p>If one process ask for close the Daemon, it will wait until all clients have been finished.</p></li><li><p>With several threads (threaded instead of async), you can run several clients in different CPUs, without increasing the time for each client. If there is only one process, the processing time will be divided between the different clients.</p></li></ul><p>The main drawback is that the @show and logs in console can be send to the last task.</p><h1 id="Typical-errors"><a class="docs-heading-anchor" href="#Typical-errors">Typical errors</a><a id="Typical-errors-1"></a><a class="docs-heading-anchor-permalink" href="#Typical-errors" title="Permalink"></a></h1><pre><code class="language-sh hljs">Error, cannot connect with server. Is it running?</code></pre><p>It could not be connected with the server, you should check it is running, and that the port used in both is the same one.</p><pre><code class="language-sh hljs">ERROR: could not open file &#39;&lt;file&gt;&#39;</code></pre><p>the file cannot be found by the server. Remember that the file is going to be searched using as current directory the directory in which the julia client is run.</p><h1 id="Changing-the-port"><a class="docs-heading-anchor" href="#Changing-the-port">Changing the port</a><a id="Changing-the-port-1"></a><a class="docs-heading-anchor-permalink" href="#Changing-the-port" title="Permalink"></a></h1><p>By default the DaemonMode work in the port 3000, but in many contexts that port can be unavailable, or been busy for another application.</p><p>it is simple to change the port, but it must be done both in the server and the client.</p><ul><li>In the server:</li></ul><pre><code class="language-julia hljs">   using DaemonMode: serve

   serve(port=9000)</code></pre><ul><li>In the client:</li></ul><pre><code class="language-julia hljs">   using DaemonMode: runargs

   runargs(port=9000)</code></pre><ul><li>or using the alias:</li></ul><pre><code class="language-sh hljs">  alias juliaclient=&#39;julia -e &quot;using DaemonMode; runargs(port=9000)&quot;&#39;</code></pre><p>That port keyword can be add to any other parameter.</p><h1 id="Different-contexts"><a class="docs-heading-anchor" href="#Different-contexts">Different contexts</a><a id="Different-contexts-1"></a><a class="docs-heading-anchor-permalink" href="#Different-contexts" title="Permalink"></a></h1><p>In order to avoid conflict of different versions of the same library, sometimes it is needed to run programs using different contexts  or environments.</p><p>This can be achieve with DaemonMode run different servers, each one using a different port.</p><pre><code class="language-julia hljs"># server1.jl
using Pkg
Pkg.activate(&quot;&lt;env_dir1&gt;&quot;)
using DaemonMode: serve
serve(3001)</code></pre><pre><code class="language-julia hljs"># server2.jl
using Pkg
Pkg.activate(&quot;&lt;env_dir2&gt;&quot;)
using DaemonMode: serve
serve(3002)</code></pre><p>First, we run the two servers:</p><pre><code class="language-sh hljs">&gt; julia server1.jl &amp;
&gt; julia server2.jl &amp;</code></pre><p>Then, to run <em>file1.jl</em> in the first context and run <em>file2.jl</em> in second environment.</p><pre><code class="language-sh hljs">julia -e &#39;using DaemonMode; runargs(3001)&#39; file1.jl</code></pre><pre><code class="language-sh hljs">julia -e &#39;using DaemonMode; runargs(3002)&#39; file1.jl</code></pre><h1 id="Shared-code-and-Conflict-of-names"><a class="docs-heading-anchor" href="#Shared-code-and-Conflict-of-names">Shared code and Conflict of names</a><a id="Shared-code-and-Conflict-of-names-1"></a><a class="docs-heading-anchor-permalink" href="#Shared-code-and-Conflict-of-names" title="Permalink"></a></h1><p>By default each file/expression is run in a new Module to avoid any conflict of names. This implies that each run is completely independently. </p><p>It is possible to run the different files/expressions in the same Module, using the parameter shared to <em>true</em> in the function <code>serve()</code>. This implies that the variables are shared between the different clients. It could be useful to avoid repeating evaluations, but it could produce conflict of names.</p><pre><code class="language-sh hljs">julia -e &#39;using DaemonMode; runargs(3001)&#39; file1.jl</code></pre><h1 id="Debugging-a-script"><a class="docs-heading-anchor" href="#Debugging-a-script">Debugging a script</a><a id="Debugging-a-script-1"></a><a class="docs-heading-anchor-permalink" href="#Debugging-a-script" title="Permalink"></a></h1><p>Sometimes the script is not lack of errors, in this case, it is only show the first line of error.</p><p>By example:</p><pre><code class="language-julia hljs">function fun2(a)
    println(a+b)
end

function fun1()
    fun2(4)
end

fun1()</code></pre><p>and the server:</p><pre><code class="language-sh hljs">julia --project -e &#39;using DaemonMode; serve(3000)&#39;</code></pre><p>The output usually should be:</p><pre><code class="language-sh hljs"># julia --project=. -e &quot;using DaemonMode; runargs()&quot; test/bad.jl 
LoadError: syntax: incomplete: premature end of input
in expression starting at string:1</code></pre><p>This is usually not wanted. </p><p>In order to fix it, and to receive more informative messages, it is recommended the parameter print_stack:</p><pre><code class="language-sh hljs">julia --project -e &#39;using DaemonMode; serve(3000, print_stack=true)&#39;</code></pre><p>When it is run the code now more informative messages:</p><pre><code class="language-sh hljs"># julia --project=. -e &quot;using DaemonMode; runargs()&quot; test/bad2.jl 
LoadError: UndefVarError: b not defined
Stacktrace:
 [1] fun2(::Int64) at ./string:2
 [2] fun1() at ./string:6
 [3] top-level scope at string:9
 [4] include_string(::Function, ::Module, ::String, ::String) at ./loading.jl:1088
 [5] include_string at ./loading.jl:1096 [inlined] (repeats 2 times)
 [6] #7 at /mnt/home/daniel/working/DaemonMode/src/DaemonMode.jl:140 [inlined]
 [7] (::DaemonMode.var&quot;#3#5&quot;{DaemonMode.var&quot;#7#9&quot;{String},Sockets.TCPSocket,Bool,Bool})() at /mnt/home/daniel/working/DaemonMode/src/DaemonMode.jl:97
 [8] redirect_stderr(::DaemonMode.var&quot;#3#5&quot;{DaemonMode.var&quot;#7#9&quot;{String},Sockets.TCPSocket,Bool,Bool}, ::Sockets.TCPSocket) at ./stream.jl:1150
 [9] #2 at /mnt/home/daniel/working/DaemonMode/src/DaemonMode.jl:88 [inlined]
 [10] redirect_stdout(::DaemonMode.var&quot;#2#4&quot;{DaemonMode.var&quot;#7#9&quot;{String},Sockets.TCPSocket,Bool,Bool}, ::Sockets.TCPSocket) at ./stream.jl:1150
 [11] serverRun at /mnt/home/daniel/working/DaemonMode/src/DaemonMode.jl:87 [inlined]
 [12] #6 at /mnt/home/daniel/working/DaemonMode/src/DaemonMode.jl:139 [inlined]
 [13] cd(::DaemonMode.var&quot;#6#8&quot;{Sockets.TCPSocket,Bool,Bool,String}, ::String) at ./file.jl:104
 [14] serverRunFile(::Sockets.TCPSocket, ::Bool, ::Bool) at /mnt/home/daniel/working/DaemonMode/src/DaemonMode.jl:137
 [15] serve(::Int64, ::Missing; print_stack::Bool) at /mnt/home/daniel/working/DaemonMode/src/DaemonMode.jl:40
 [16] top-level scope at none:1
 [17] eval(::Module, ::Any) at ./boot.jl:331
 [18] exec_options(::Base.JLOptions) at ./client.jl:272
 [19] _start() at ./client.jl:506
in expression starting at string:9</code></pre><p>Obviously, the majority of the complete stack mention the DaemonMode functions, but at least the error can be identified more easily.</p><h1 id="Including-a-file"><a class="docs-heading-anchor" href="#Including-a-file">Including a file</a><a id="Including-a-file-1"></a><a class="docs-heading-anchor-permalink" href="#Including-a-file" title="Permalink"></a></h1><p>In first versions of the package, you cannot use the &quot;include&quot; function to include the code of an external file (for a better organization of the code). This has been solved, so now you can use include function as normal.</p><p>Example:</p><p>In file <strong>include_test.jl</strong>:</p><pre><code class="language-julia hljs">include(&quot;to_include.jl&quot;)

println(f_aux(2,3))</code></pre><p>and in <strong>to_include.jl</strong>:</p><pre><code class="language-julia hljs">function f_aux(a,b)
    return a*b
end</code></pre><pre><code class="language-sh hljs"># julia --project=. -e &quot;using DaemonMode; runargs()&quot; include_test.jl 
6</code></pre><p>Remember that the current directory is the directory in which julia command is run, so it is recommended to run in the same directory that the script with the include.</p><h1 id="Automatically-reload-the-modified-packages"><a class="docs-heading-anchor" href="#Automatically-reload-the-modified-packages">Automatically reload the modified packages</a><a id="Automatically-reload-the-modified-packages-1"></a><a class="docs-heading-anchor-permalink" href="#Automatically-reload-the-modified-packages" title="Permalink"></a></h1><p>DaemonMode would execute the codes that are directly passed to the server, so each time the codes are updated, you would get the up-to-date results. However, sometimes you may also be developing some packages in the same time, and want they got reloaded when modified. You can use Revise together with DaemonMode for this purpose. You only need to add <code>using Revise</code>, before starting the DaemonMode server:</p><pre><code class="language-julia hljs">julia --startup-file=no -e &#39;using Revise; using DaemonMode; serve()&#39;</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Quick Start</a><a class="docs-footer-nextpage" href="../posibilities/">Posibilities »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.19 on <span class="colophon-date" title="Thursday 9 June 2022 11:38">Thursday 9 June 2022</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
